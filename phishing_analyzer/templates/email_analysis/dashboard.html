{% extends 'base.html' %}

{% block title %}Executive Dashboard - {{ block.super }}{% endblock %}

{% block page_title %}Executive Dashboard{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item active">Dashboard</li>
{% endblock %}

{% block header_actions %}
<div class="d-flex align-items-center gap-2">
    <div class="dropdown">
        <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
            <i class="fas fa-download me-2"></i>Export Reports
        </button>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#" onclick="exportReport('pdf')"><i class="fas fa-file-pdf me-2"></i>Executive Summary (PDF)</a></li>
            <li><a class="dropdown-item" href="#" onclick="exportReport('csv')"><i class="fas fa-file-csv me-2"></i>Detailed Data (CSV)</a></li>
            <li><a class="dropdown-item" href="#" onclick="exportReport('json')"><i class="fas fa-file-code me-2"></i>API Data (JSON)</a></li>
        </ul>
    </div>
    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#analyzeEmailModal">
        <i class="fas fa-plus me-2"></i>New Analysis
    </button>
    <button type="button" class="btn btn-success btn-sm" onclick="refreshDashboard()">
        <i class="fas fa-sync-alt me-2"></i>Refresh
    </button>
</div>
{% endblock %}

{% block content %}
<!-- Real-time Threat Intelligence Banner -->
<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-info border-0 shadow-sm d-flex align-items-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <i class="fas fa-shield-alt fa-2x me-3"></i>
            <div class="flex-grow-1">
                <h5 class="mb-1">Threat Intelligence Status</h5>
                <p class="mb-0">Real-time monitoring active • Last updated: <span id="lastUpdated">{{ current_time|default:"Just now" }}</span> • 
                <span class="badge bg-success ms-2">All Systems Operational</span></p>
            </div>
            <div class="text-end">
                <div class="h4 mb-0">{{ threat_level|default:"MODERATE" }}</div>
                <small>Current Threat Level</small>
            </div>
        </div>
    </div>
</div>

<!-- Executive KPI Cards -->
<div class="row mb-4">
    <div class="col-xl-3 col-lg-6 mb-4">
        <div class="card stats-card primary h-100">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total Email Analyses</div>
                        <div class="h3 mb-0 font-weight-bold text-gray-800" id="totalAnalyses">{{ total_analyses|default:0 }}</div>
                        <div class="mt-2">
                            <span class="text-success small">
                                <i class="fas fa-arrow-up"></i> +12% from last month
                            </span>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="icon-circle bg-primary">
                            <i class="fas fa-envelope-open-text text-white"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-lg-6 mb-4">
        <div class="card stats-card danger h-100">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col">
                        <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Critical Threats Blocked</div>
                        <div class="h3 mb-0 font-weight-bold text-gray-800" id="highRiskCount">{{ high_risk_count|default:0 }}</div>
                        <div class="mt-2">
                            <span class="text-danger small">
                                <i class="fas fa-arrow-up"></i> +3 this week
                            </span>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="icon-circle bg-danger">
                            <i class="fas fa-exclamation-triangle text-white"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-lg-6 mb-4">
        <div class="card stats-card warning h-100">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col">
                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Suspicious Activity</div>
                        <div class="h3 mb-0 font-weight-bold text-gray-800" id="mediumRiskCount">{{ medium_risk_count|default:0 }}</div>
                        <div class="mt-2">
                            <span class="text-warning small">
                                <i class="fas fa-minus"></i> Stable trend
                            </span>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="icon-circle bg-warning">
                            <i class="fas fa-exclamation-circle text-white"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-lg-6 mb-4">
        <div class="card stats-card success h-100">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Security Score</div>
                        <div class="h3 mb-0 font-weight-bold text-gray-800">98.7%</div>
                        <div class="mt-2">
                            <span class="text-success small">
                                <i class="fas fa-arrow-up"></i> +0.3% improvement
                            </span>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="icon-circle bg-success">
                            <i class="fas fa-shield-check text-white"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Advanced Analytics Row -->
<div class="row mb-4">
    <div class="col-xl-8">
        <div class="card shadow-sm h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Threat Detection Trends</h5>
                <div class="btn-group btn-group-sm" role="group">
                    <input type="radio" class="btn-check" name="chartPeriod" id="chart7d" autocomplete="off" checked>
                    <label class="btn btn-outline-primary" for="chart7d">7D</label>
                    
                    <input type="radio" class="btn-check" name="chartPeriod" id="chart30d" autocomplete="off">
                    <label class="btn btn-outline-primary" for="chart30d">30D</label>
                    
                    <input type="radio" class="btn-check" name="chartPeriod" id="chart90d" autocomplete="off">
                    <label class="btn btn-outline-primary" for="chart90d">90D</label>
                </div>
            </div>
            <div class="card-body">
                <canvas id="threatTrendsChart" height="300"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-xl-4">
        <div class="card shadow-sm h-100">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Threat Distribution</h5>
            </div>
            <div class="card-body">
                <canvas id="threatDistributionChart" height="300"></canvas>
                <div class="mt-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="d-flex align-items-center">
                            <span class="badge bg-danger me-2"></span>
                            Phishing Attempts
                        </span>
                        <strong>{{ phishing_percentage|default:"45" }}%</strong>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="d-flex align-items-center">
                            <span class="badge bg-warning me-2"></span>
                            Malware Attachments
                        </span>
                        <strong>{{ malware_percentage|default:"28" }}%</strong>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="d-flex align-items-center">
                            <span class="badge bg-info me-2"></span>
                            Suspicious Links
                        </span>
                        <strong>{{ suspicious_links_percentage|default:"19" }}%</strong>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="d-flex align-items-center">
                            <span class="badge bg-secondary me-2"></span>
                            Other Threats
                        </span>
                        <strong>{{ other_threats_percentage|default:"8" }}%</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Real-time Monitoring & Recent Activity -->
<div class="row mb-4">
    <div class="col-xl-6">
        <div class="card shadow-sm h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Recent Threat Activity</h5>
                <span class="badge bg-primary">Live</span>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Time</th>
                                <th>Threat Type</th>
                                <th>Source</th>
                                <th>Risk Level</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivity">
                            <tr>
                                <td><small>2 min ago</small></td>
                                <td><i class="fas fa-envelope text-danger me-1"></i>Phishing</td>
                                <td>external-sender@suspicious.com</td>
                                <td><span class="badge bg-danger">HIGH</span></td>
                                <td><span class="badge bg-success">Blocked</span></td>
                            </tr>
                            <tr>
                                <td><small>5 min ago</small></td>
                                <td><i class="fas fa-link text-warning me-1"></i>Malicious URL</td>
                                <td>newsletter@fake-bank.net</td>
                                <td><span class="badge bg-warning">MEDIUM</span></td>
                                <td><span class="badge bg-success">Quarantined</span></td>
                            </tr>
                            <tr>
                                <td><small>12 min ago</small></td>
                                <td><i class="fas fa-file text-info me-1"></i>Suspicious Attachment</td>
                                <td>invoice@accounting-fake.org</td>
                                <td><span class="badge bg-info">LOW</span></td>
                                <td><span class="badge bg-primary">Analyzing</span></td>
                            </tr>
                            <tr>
                                <td><small>18 min ago</small></td>
                                <td><i class="fas fa-user-secret text-danger me-1"></i>Spoofing</td>
                                <td>ceo@eliteluxe-fake.com</td>
                                <td><span class="badge bg-danger">HIGH</span></td>
                                <td><span class="badge bg-success">Blocked</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-6">
        <div class="card shadow-sm h-100">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-globe me-2"></i>Global Threat Intelligence</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <div class="text-center p-3 border rounded mb-3">
                            <div class="h4 text-primary mb-1">{{ global_threats_today|default:"1,247" }}</div>
                            <small class="text-muted">Global Threats Today</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center p-3 border rounded mb-3">
                            <div class="h4 text-success mb-1">{{ protection_rate|default:"99.8" }}%</div>
                            <small class="text-muted">Protection Rate</small>
                        </div>
                    </div>
                </div>
                
                <h6 class="mb-3">Top Threat Sources</h6>
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span><i class="fas fa-flag me-2"></i>Russia</span>
                        <div class="flex-grow-1 mx-3">
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar bg-danger" style="width: 78%"></div>
                            </div>
                        </div>
                        <span class="text-muted">78%</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span><i class="fas fa-flag me-2"></i>China</span>
                        <div class="flex-grow-1 mx-3">
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar bg-warning" style="width: 65%"></div>
                            </div>
                        </div>
                        <span class="text-muted">65%</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span><i class="fas fa-flag me-2"></i>North Korea</span>
                        <div class="flex-grow-1 mx-3">
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar bg-info" style="width: 42%"></div>
                            </div>
                        </div>
                        <span class="text-muted">42%</span>
                    </div>
                </div>
                
                <div class="alert alert-warning border-0 p-2">
                    <small><i class="fas fa-exclamation-triangle me-1"></i>
                    <strong>Alert:</strong> Increased phishing activity detected from Eastern European IP ranges.</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Performance & Health -->
<div class="row mb-4">
    <div class="col-xl-4">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-server me-2"></i>System Performance</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <span>CPU Usage</span>
                        <span class="text-success">23%</span>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-success" style="width: 23%"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <span>Memory Usage</span>
                        <span class="text-info">67%</span>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-info" style="width: 67%"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <span>Disk Usage</span>
                        <span class="text-warning">45%</span>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-warning" style="width: 45%"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <span>Analysis Queue</span>
                        <span class="text-primary">{{ queue_size|default:"12" }} items</span>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-primary" style="width: 30%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-4">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-users me-2"></i>User Activity</h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>Active Users</span>
                    <span class="badge bg-success">{{ active_users|default:"24" }} online</span>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>Analyses Today</span>
                    <span class="h6 mb-0">{{ analyses_today|default:"156" }}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>Reports Generated</span>
                    <span class="h6 mb-0">{{ reports_today|default:"43" }}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>API Calls</span>
                    <span class="h6 mb-0">{{ api_calls_today|default:"2,847" }}</span>
                </div>
                
                <hr>
                
                <h6 class="mb-2">Top Analysts</h6>
                <div class="d-flex align-items-center mb-2">
                    <div class="user-avatar me-2" style="width: 24px; height: 24px; font-size: 12px;">JS</div>
                    <span class="flex-grow-1">John Smith</span>
                    <span class="text-muted small">47 analyses</span>
                </div>
                <div class="d-flex align-items-center mb-2">
                    <div class="user-avatar me-2" style="width: 24px; height: 24px; font-size: 12px;">MJ</div>
                    <span class="flex-grow-1">Maria Johnson</span>
                    <span class="text-muted small">38 analyses</span>
                </div>
                <div class="d-flex align-items-center">
                    <div class="user-avatar me-2" style="width: 24px; height: 24px; font-size: 12px;">DW</div>
                    <span class="flex-grow-1">David Wilson</span>
                    <span class="text-muted small">31 analyses</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-4">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Weekly Summary</h5>
            </div>
            <div class="card-body">
                <canvas id="weeklySummaryChart" height="200"></canvas>
                <div class="mt-3">
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="h5 text-danger mb-0">{{ weekly_high_risk|default:"23" }}</div>
                            <small class="text-muted">High Risk</small>
                        </div>
                        <div class="col-4">
                            <div class="h5 text-warning mb-0">{{ weekly_medium_risk|default:"67" }}</div>
                            <small class="text-muted">Medium Risk</small>
                        </div>
                        <div class="col-4">
                            <div class="h5 text-success mb-0">{{ weekly_low_risk|default:"234" }}</div>
                            <small class="text-muted">Low Risk</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions & Email Analysis Modal -->
<div class="modal fade" id="analyzeEmailModal" tabindex="-1" aria-labelledby="analyzeEmailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="analyzeEmailModalLabel">
                    <i class="fas fa-search me-2"></i>Quick Email Analysis
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="quickAnalysisForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="emailSubject" class="form-label">Email Subject</label>
                            <input type="text" class="form-control" id="emailSubject" placeholder="Enter email subject">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="senderEmail" class="form-label">Sender Email</label>
                            <input type="email" class="form-control" id="senderEmail" placeholder="sender@example.com">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="recipientEmail" class="form-label">Recipient Email</label>
                            <input type="email" class="form-control" id="recipientEmail" placeholder="recipient@eliteluxe.com">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="priority" class="form-label">Analysis Priority</label>
                            <select class="form-select" id="priority">
                                <option value="normal">Normal</option>
                                <option value="high">High Priority</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="emailBody" class="form-label">Email Content</label>
                        <textarea class="form-control" id="emailBody" rows="6" placeholder="Paste email content here..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitQuickAnalysis()">
                    <i class="fas fa-play me-2"></i>Start Analysis
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.icon-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

.bg-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
}

.bg-danger {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%) !important;
}

.bg-warning {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%) !important;
}

.bg-success {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
}

.progress {
    background-color: #e9ecef;
    border-radius: 10px;
}

.progress-bar {
    border-radius: 10px;
}

.table th {
    font-weight: 600;
    font-size: 0.875rem;
    color: #6c757d;
    border-bottom: 2px solid #dee2e6;
}

.badge {
    font-size: 0.75rem;
    font-weight: 500;
}

.card-header h5 {
    color: #495057;
    font-weight: 600;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Initialize Charts
document.addEventListener('DOMContentLoaded', function() {
    initializeThreatTrendsChart();
    initializeThreatDistributionChart();
    initializeWeeklySummaryChart();
    startRealTimeUpdates();
});

function initializeThreatTrendsChart() {
    const ctx = document.getElementById('threatTrendsChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'High Risk',
                data: [12, 19, 8, 15, 22, 8, 13],
                borderColor: '#fa709a',
                backgroundColor: 'rgba(250, 112, 154, 0.1)',
                tension: 0.4
            }, {
                label: 'Medium Risk',
                data: [28, 35, 22, 41, 38, 25, 32],
                borderColor: '#43e97b',
                backgroundColor: 'rgba(67, 233, 123, 0.1)',
                tension: 0.4
            }, {
                label: 'Low Risk',
                data: [45, 52, 38, 67, 58, 42, 55],
                borderColor: '#4facfe',
                backgroundColor: 'rgba(79, 172, 254, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0,0,0,0.05)'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(0,0,0,0.05)'
                    }
                }
            }
        }
    });
}

function initializeThreatDistributionChart() {
    const ctx = document.getElementById('threatDistributionChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Phishing', 'Malware', 'Suspicious Links', 'Other'],
            datasets: [{
                data: [45, 28, 19, 8],
                backgroundColor: [
                    '#fa709a',
                    '#43e97b', 
                    '#4facfe',
                    '#6c757d'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}

function initializeWeeklySummaryChart() {
    const ctx = document.getElementById('weeklySummaryChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Threats Detected',
                data: [23, 35, 18, 42, 28, 15, 25],
                backgroundColor: 'rgba(102, 126, 234, 0.8)',
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0,0,0,0.05)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
}

function startRealTimeUpdates() {
    // Update every 30 seconds
    setInterval(function() {
        updateLastUpdatedTime();
        // In a real application, you would fetch new data from the server
        // updateDashboardData();
    }, 30000);
}

function updateLastUpdatedTime() {
    document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
}

function refreshDashboard() {
    // Show loading state
    const refreshBtn = event.target;
    const originalHtml = refreshBtn.innerHTML;
    refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Refreshing...';
    refreshBtn.disabled = true;
    
    // Simulate refresh (in real app, fetch new data)
    setTimeout(function() {
        refreshBtn.innerHTML = originalHtml;
        refreshBtn.disabled = false;
        updateLastUpdatedTime();
        
        // Show success message
        showToast('Dashboard refreshed successfully', 'success');
    }, 2000);
}

function exportReport(format) {
    showToast(`Exporting ${format.toUpperCase()} report...`, 'info');
    
    // Simulate export (in real app, generate and download report)
    setTimeout(function() {
        showToast(`${format.toUpperCase()} report exported successfully`, 'success');
    }, 1500);
}

function submitQuickAnalysis() {
    const form = document.getElementById('quickAnalysisForm');
    const formData = new FormData(form);
    
    // Show loading state
    const submitBtn = event.target;
    const originalHtml = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Analyzing...';
    submitBtn.disabled = true;
    
    // Simulate analysis (in real app, submit to server)
    setTimeout(function() {
        submitBtn.innerHTML = originalHtml;
        submitBtn.disabled = false;
        
        // Close modal and show success
        bootstrap.Modal.getInstance(document.getElementById('analyzeEmailModal')).hide();
        showToast('Email analysis started successfully', 'success');
        
        // Reset form
        form.reset();
    }, 3000);
}

function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toastContainer') || createToastContainer();
    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-white bg-${type} border-0`;
    toast.setAttribute('role', 'alert');
    toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">${message}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    `;
    
    toastContainer.appendChild(toast);
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
    
    // Remove toast after it's hidden
    toast.addEventListener('hidden.bs.toast', function() {
        toast.remove();
    });
}

function createToastContainer() {
    const container = document.createElement('div');
    container.id = 'toastContainer';
    container.className = 'toast-container position-fixed top-0 end-0 p-3';
    container.style.zIndex = '1055';
    document.body.appendChild(container);
    return container;
}
</script>
{% endblock %}